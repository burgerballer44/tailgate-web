{% extends "layout/dashboard-base-normal.twig" %}

{% block content %}

    {% if group is defined %}

        <h1 class="text-2xl mb-4">{{ group.name }}</h1>

        {% if isGroupAdmin(member) %}
            <div class="my-4">
                <a class="p-2 mr-2 bg-gray-300 rounded" href={{ url_for('send-invite', { 'groupId': group.groupId }) }}>Send an Invite</a>
                {% if isGroupOwner(group, member) %}
                    <a class="p-2 mr-2 bg-gray-300 rounded" onclick="if (!confirm('Are you sure?')) return false;" href={{ url_for('delete-group', { 'groupId': group.groupId }) }}>Delete Group</a>
                {% endif %}

                {# determine if the group is following a team #}
                {% if group.follow is defined and group.follow is not null %}

                    {# the follow can be removed as long as there are no scores submitted #}
                    {% if group.scores is defined and group.scores is empty %}
                        <a class="p-2 mr-2 bg-gray-300 rounded" onclick="if (!confirm('Are you sure?')) return false;" href={{ url_for('delete-follow', { 'groupId': group.groupId, 'followId': group.follow.followId }) }}>Delete Follow</a>
                    {% endif %}

                    <p class="p-2">Following the {{ group.follow.teamDesignation }} {{ group.follow.teamMascot }} for {{ group.follow.seasonName }}.</p>

                {# if not then show the button to the follow form #}
                {% else %}
                    <a class="p-2 mr-2 bg-gray-300 rounded" href={{ url_for('follow-team', { 'groupId': group.groupId }) }}>Follow Team</a>
                {% endif %}
            </div>
        {% endif %}

        <h1 class="text-xl underline">Players</h1>

        <div class="my-4">
            <a class="p-2 mr-2 bg-gray-300 rounded" href={{ url_for('add-player', { 'groupId': member.groupId, 'memberId': member.memberId }) }}> Add Player </a>
        </div>


        <div data-controller="tabs" data-tabs-active-tab="-mb-px border-l border-t border-r rounded-t">
            <ul class="list-reset flex border-b">

                <li class="-mb-px mr-1" data-target="tabs.tab" data-action="click->tabs#change">
                    <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-700 font-semibold no-underline" href="#">Leaderboad</a>
                </li>

                <li class="mr-1" data-target="tabs.tab" data-action="click->tabs#change">
                    <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-700 font-semibold no-underline" href="#">Table</a>
                </li>

                {% if isGroupAdmin(member) %}
                    <li class="mr-1" data-target="tabs.tab" data-action="click->tabs#change">
                        <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-700 font-semibold no-underline" href="#">Members</a>
                    </li>
                {% endif %}

                {% if isGroupAdmin(member) %}
                    <li class="mr-1" data-target="tabs.tab" data-action="click->tabs#change">
                        <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-700 font-semibold no-underline" href="#">Players</a>
                    </li>
                {% endif %}

                {% if isGroupAdmin(member) %}
                    <li class="mr-1" data-target="tabs.tab" data-action="click->tabs#change">
                        <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-700 font-semibold no-underline" href="#">Scores</a>
                    </li>
                {% endif %}
            </ul>

            <div class="hidden py-4 px-4 border-l border-b border-r" data-target="tabs.panel">
                {{ leaderboard|raw }}
            </div>

            <div class="hidden py-4 px-4 border-l border-b border-r" data-target="tabs.panel">
                {{ scoreChart|raw }}
            </div>




            {% if isGroupAdmin(member) %}
                <div class="hidden py-4 px-4 border-l border-b border-r" data-target="tabs.panel">
                    <div class="my-4">
                        <h1 class="text-xl underline">Members</h1>

                        {% if group.members is defined %}

                            {{ tableStart()|raw }}

                            <tr class="border-b border-black">
                                {{ tableHeader('Email')|raw }}
                                {{ tableHeader('Role')|raw }}
                                {{ tableHeader('Allow Multiple')|raw }}
                                {{ tableHeader('')|raw }}
                                {{ tableHeader('')|raw }}
                                {{ tableHeader('')|raw }}
                            </tr>

                            {% for member in group.members %}

                                <tr class="border-b hover:bg-orange-100 bg-gray-100">
                                    {{ tableHeader(member.email)|raw }}
                                    {{ tableHeader(member.role)|raw }}
                                    {{ tableHeader(member.allowMultiplePlayers ? 'Yes':'No')|raw }}
                                    <td class='p-1 py-2'><a href={{ url_for('add-player', { 'groupId': member.groupId, 'memberId': member.memberId }) }}> <u>Add Player</u> </a></td>
                                    <td class='p-1 py-2'><a href={{ url_for('update-member', { 'groupId': member.groupId, 'memberId': member.memberId }) }}> <u>Update Member</u> </a></td>
                                    <td class='p-1 py-2'><a onclick="if (!confirm('Are you sure?')) return false;" href={{ url_for('delete-member', { 'groupId': member.groupId, 'memberId': member.memberId }) }}> <u>Delete Member</u> </a></td>
                                </tr>

                            {% endfor %}

                            {{ tableEnd()|raw }}

                        {% endif %}

                    </div>
                </div>
                
            {% endif %}

            {% if isGroupAdmin(member) %}
                <div class="hidden py-4 px-4 border-l border-b border-r" data-target="tabs.panel">
                    {% if group.players is defined %}
                        {% for player in group.players %}
                            <div>
                                <a onclick="if (!confirm('Are you sure?')) return false;" href={{ url_for('delete-player', { 'groupId': player.groupId, 'playerId': player.playerId }) }}> <u>Delete Player</u> </a>
                                <a href={{ url_for('update-player', { 'groupId': player.groupId, 'playerId': player.playerId }) }}> <u>Update Player</u> </a>
                                <a href={{ url_for('submit-score', { 'groupId': player.groupId, 'playerId': player.playerId }) }}> <u>Submit Score</u> </a>
                                {{ player.username }}  
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            {% endif %}

            {% if isGroupAdmin(member) %}
                <div class="hidden py-4 px-4 border-l border-b border-r" data-target="tabs.panel">
                    <h1 class="text-xl underline">Scores</h1>

                    {% if group.scores is defined %}
                        {% for score in group.scores %}
                            <div>
                                <a href={{ url_for('update-score', { 'groupId': score.groupId, 'scoreId': score.scoreId }) }}> <u>Update Score</u> </a>
                                <a onclick="if (!confirm('Are you sure?')) return false;" href={{ url_for('delete-score', { 'groupId': score.groupId, 'scoreId': score.scoreId }) }}> <u>Delete Score</u> </a>
                                {{ score.homeDesignation }} {{ score.homeMascot }} - {{ score.homeTeamPrediction }}  {{ score.awayDesignation }} {{ score.awayMascot }} - {{ score.awayTeamPrediction }}  
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            {% endif %}

        </div>

    {% endif %}


    <script src="https://unpkg.com/stimulus/dist/stimulus.umd.js"></script>
    <script src="https://unpkg.com/tailwindcss-stimulus-components/dist/tailwindcss-stimulus-components.js"></script>

    <script>
          const application = Stimulus.Application.start();
          application.register('dropdown', TailwindcssStimulusComponents.Dropdown);
          application.register('modal', TailwindcssStimulusComponents.Modal);
          application.register('tabs', TailwindcssStimulusComponents.Tabs);
          application.register('popover', TailwindcssStimulusComponents.Popover);
    </script>

{% endblock %}
